# Redshift

* スナップショット用に無料ストレージを提供している
* 容量の上限に達すると課金される
* 拡張VPCルーティングを有効にするとVPC経由のルーティングを強制し、クラスタのすべてのCOPY、UNLOADトラフィックを可視できる

# Auto Scaling

* うまく実行されずに24時間以上経過した場合、途中でスケーリング処理が停止する
* ターミネーションポリシーの設定が可能
  * どれから削除するか
* ターゲットトラッキングポリシー
  * リソースのしきい値を指定してそれを維持するようにスケーリング

# S3

* ストレージゲートウェイのキャッシュ型ボリュームはローカルに高頻度アクセスデータをキャッシュしながらS3をプライマリとして使える
* 署名付きURLにより一時的な期限付きのアクセスができる
* プレフィックスを利用して日付ベースでアップロードを分散することができる
* 強い整合性モデルをもっているためデータ更新の反映に誤差は生じない
* MFA認証設定可能
* オブジェクトロックはバケット作成時にのみ設定可能
  * WriteOnceにできる
* 暗号化方式
  * SSE-S3 標準の方式
  * SSE-KMS KMSに設定した暗号化キーを使用した方式
    * つまり管理者が鍵を作成したり管理が必要
    *  KMSはキーの自動ローテーションを設定できる
    * KMSのアクセス権限を付与しなかったらオブジェクトの閲覧はできない
  * SSE-C ユーザが指定したキーによる暗号化
  * クライアントサイド暗号化 データ送信前に暗号化
* サーバサイド暗号化により各アクセスログは自動的に暗号化される
* クロスリージョンレプリケーションを設定すると、バケットにオブジェクトの変更された際のイベントをトリガーにレプリケーションされる
* タイプ
  * standard 頻繁に利用するデータ向け
  * standard-IA Infrequency Access 低頻度アクセス向け OneZone-IAよりかは重要なマスタデータ向け
  * One Zone-IA マルチAZではない。重要ではないデータ向け
  * S3 IntelligentTiering アクセス頻度に応じて自動的にクラス分け、アクセスパターンがわからない時向け
* クロスアカウントアクセス、リクエスタ支払いによりコスト負担をリクエスト者にすることができる
* ストレージクラス分析により適切なストレージクラスを選択できる
* マルチパートアップロードにより分割アップロードできる
* イベントトリガーでLambdaなどが動かせる
* S3 SelectによりシンプルなSQLステートメントを利用してコンテンツのフィルタリングできる
* パブリックに公開するには適切なバケットポリシーを設定する
* 暗号化情報なしのPUTリクエストを拒否するポリシーを設定されていると、登録に失敗する
* S3オブジェクトURLに直接アクセスできないようにするには
  * CloudFrontでオリジンアクセスアイデンティティ(OAI)を割り当てそのOAIのみ読み取り権限があるようにS3パケットポリシーを設定する
  * 同様にオリジンアクセスコントロール(OAC)での設定も可能
* URLは bucketname.s3-website-region.amazonaws.com
* もしくは bucketname.s3-website.region.amazonaws.com
* MFA Deletを有効化すると削除時に認証が求められる
# Amazon Glacier 
* Flexible Retrieval
  * データ取得タイプにより取り出し速度が変わる
    * 迅速 1-5分
    * プロビジョニングキャパシティ 迅速取り出しの取得容量を必要なときに利用できることを保証する
    * 標準 3-5時間
    * 大容量 5-12時間
  * 管理方式
    * IAMポリシー
    * ボールトポリシー 
      * 組織内外のユーザに対してもアクセス権を付与
    * データ取り出しポリシー
      * 無料利用枠のみに制限、取り出しコストの上限を設定など
    * ボールトロックポリシー
      * ロックによって変更を禁止するなどできる
    * 署名


# Amazon ECS

* コンテナ化されたアプリケーションをかんたんにデプロイ、管理、スケールできる
* EC2インスタンスをコンテナに利用できるEC2起動モードとサーバレスコンピューティングサービスのFargate起動モードを選択できる
* Fargateはコンテナを実行するためにクラスタプロビジョニング、設計、スケールが不要
* セキュリティグループの反映はすぐに行われる
* AutoScalingグループをECSクラスタに関連付ける場合、直接ECSニアタッチしてからそのグループに対してALBのアタッチを行う#

# ALB
* 簡易スケーリングポリシー
  * アラーム設定に基づいて1段階のスケーリングを実施
* ステップスケーリングポリシー
  * ステップ調整値に基づいた段階的なスケーリング
* 手動
* スケジュールされたスケーリング
* メモリ利用率をトリガにはできない
* 最小キャパシティ 
  * スケールイン時にインスタンスを削除する際の下限
* 最大キャパシティ 
  * スケールアウト時にインスタンスを起動する最大値
* 希望する容量
  * AutoScalingが実行されない状態のインスタンス数
# EC2

* デフォルトではEC2インスタンスのパブリックIPはインスタンス停止後に開放される
* Elastic IPを設定するとIPは持続する
* VPCエンドポイントを使用するとインターネットを介さずにVPC内のサービスからVPC外のAWSサービスに接続できる
* S3にアクセスするためにゲートウェイエンドポイント,インターフェイスエンドポイントを使う
* インスタンスサイズを増加させるとIOPSもあがる
* インスタンスの種類
  * 汎用 A1,M5,T3など
  * コンピューティング最適化 C5,C6a
  * メモリ最適化 X1,R5
  * ストレージ最適化 H1,D2,I3など
  * 高速コンピューティング P3,Inf1,G4,F1
* スポットブロック機能
  * スポットインスタンスを1-6時間継続して利用する機能だがもうない
* オンデマンドインスタンスのキャパシティ予約をすると必要な期間中のみオンデマンドの料金でキャパシティが予約できる
* VPCフローログ
  * ネットワークトラフィックを監視してCloudWatchでモニタリングできるようにする
* IPフローティングによりEC2障害発生時に即座にIPを別のEC2に付け替えられる
* リザーブドインスタンス(コンバーティブル)は契約後にインスタンスなどの変更が可能
## EBSボリューム

* 汎用SSD
* プロビジョンドIOPS
  * 高I/O性能(NoSQLなど)
  * 10000IOPS
  * Nitroシステム,EBS最適化インスタンスタイプ
  * io2 Block Expressが最高性能
  * io2 は最大性能が1000MB/s
  * IOPS:容量(GB)の最大比は50:1
* スループット最適化HDD
  * ビッグデータ処理
  * DWH
  * 大規模なログ分析
  * ルートボリュームには使用不可
* コールドHDD
  * ログデータなど低アクセス頻度のもの
  * backup
  * ルートボリュームには使用不可
* マグネティック
  * 基本使わない
* Amazon Data Lifecycle Manager(DLM)
  * EBSの定期的なバックアップ
  * コンプラ向けのバックアップ
  * 不要なバックアップを削除
* DeleteOnTermination属性
  * EC2のルートボリュームを残す
* でタッチするにはEC2を「停止」.削除すると一緒に消える
* EC2は他のAZのEBSにはアクセスできない

# IAM

* クロスアカウントアクセス
  * 特定のアカウントにある特定のリソースを別のアカウントのユーザと共有できる
* タグ付けされたリソースにIAMポリシーによりアクセス制御可能
* Lambda関数を利用してDynamoDBへデータ登録する場合LambdaにIAMロールによるDynamoDBへのアクセス許可を設定する必要がある
* EC2,RDSインスタンスにはIAMロールの認証情報と認証トークンを使って接続できる

# Route53

* ルーティングポリシー
  * 位置情報
  * 地理的近接性
    * リソースの場所に基づいてルーティング。
  * 複数値回答
    * いわゆるランダム
* CloudFrontなどのAWSリソースを使用する場合はAliasレコードを利用する
* フェイルオーバールーティング
  * アクティブ/アクティブ構成でリソースを平等に利用できる
* DR環境構築もできる
* シャッフルシェーディングDDos攻撃を緩和する

# Aurora

* Auroraレプリカを複数AZに配置できる
* プライマリインスタンスに障害が発生した時、レプリカが昇格する
* デフォルトでマルチAZクラスタ構成になっている
* マルチリージョン構成なのでGlobal Databaseはない

# DynamoDB

* オンデマンドモードがある。キャパシティを自動で調整できる
* プロビジョンドスループットモード
  * テーブルごとにRead/Writeに対して必要なするプットキャパシティを与える
* トランザクション機能でテーブルに対する一つのオペレーションとして複数の項目の追加更新削除が必要となるビジネスワークフローを管理できる
* DynamoDBストリームにはデータ処理を動的に行うと言った機能はない
* AutoScalingで負荷に応じたパフォーマンス強化を自動化できる
* DynamoDBにDBイベントという機能はない
* AWS Data pipelineを設定できる
* SynamoDBストリームはテーブルに保存された項目の変更をキャプチャする機能
* グローバルテーブルはマルチリージョンにマルチマスターデータベースをデプロイする
* ポイントタイムリカバリにより過去35日間の任意の時点に復元できる
* 結果整合性モデルを選択するとスループットが最大限向上
  * ただし最新の結果でない場合がある
* 強い整合性のある読み込みは適切な応答を受け取ったすべての書き込みが反映されている
# RDS

* リードレプリカは非同期にレプリケーとされるのでラグがある
* インスタンスクラス
  * db.m5d 定例天使、高ランダムI/Oパフォーマンス、高シーケンシャル読み取りスループット
* ストレージタイプ
  * プロビジョンドIOPS
* 拡張モニタリングでDBインスタンスのリアルタイムメトリックスが確認できる
* マルチAZのRDSではプライマリがダウンしたらフェールオーバされる
  * DBインスタンスのCNAMEをスタンバイから切り替えてプライマリに昇格する
* Amazon RDS ProxyによりLambdaなどから直接RDSに繋がず既存のコネクションを効率的に再利用できる

# AWS WAF
* FW
* リファラ制限などかけられる

# SQS
* FIFOキューはメッセージ順序を保証し、すくなくとも1回のメッセージ配信をサポート
* Amazon SNSのFIFOトピックを導入することで複数のサブスクライバーに厳密なメッセージの順序付けと重複削除ができる
* 負荷分散可能なキューイングサービス
  * 水平方向のスケーリングに役立つ
* 可視性タイムアウト
  * メッセージがコンシューマに受信された直後はメッセージはキューに残ったままになる、他のコンシューマがメッセージを処理しないように設定する
  * 可視性タイムアウト時間まで他のコンシューマは処理を行わないので時間を減らせば待ち時間を短縮できる
* キューに優先度を設定可能
* メッセージ保持期間は設定で変更可能、デフォルトは4日

# lambda
* APIゲートウェイと連携してHTTPでアクセスできるようにできる
* 関数URLを指定してHTTPでこうかいすることもできる
* デッドレターキュー 実行に失敗したメッセージをSQSにためる
* ローカルテストはAWS SAM(Serverless Application Model)を使う
* Lambda layerはlambda関数でライブラリを共有する仕組み

# Amazon Kinesis Data Streams
* パフォーマンス調整としてリシャーディングが備わっている
  * シャードを分割、結合する
  * シャード単位で請求されるので分割するとコストが上がる

* ホットシャード、予想よりも遥かに多くのデータを受信するシャード
* コールドシャード、遥かに少ない
* 各レコードはシーケンスが振られているのでメッセージの重複、損失がない、同じ順序で伝送される
* あくまでもストリーム用。写真処理などはできない
# DirectConnect
専用線、最も低レイテンシーで高性能で安全

# Amazon Cognito
アプリに認証機能をつけられる,MFAにもたいおう


# Amazon SNS
* SNS対応デバイスにSMSメッセージを送信する
* プッシュ通知からSQSやLambdaを実行することができる

# CloudWatch
* 関しは可能だが即時に連絡を送る仕組みはない

# AmazonSES
* Eメール機能をAWS上で提供するサービス
* メッセージ通知機能ではない
* 一斉メール送信などに使う

# Lustre

* オープンソースのファイルシステム

# VPCエンドポイント
* ゲートウェイエンドポイント
  * S3 DynamoDBをターゲットにしたエンドポイント

# Amazon CloudFront
* コンテンツ配信サービス
* オンプレミスにも対応
* cache-controlの指定が可能

# Aurora Serverless
* インスタンスクラスのサイズを指定せずにデータベースエンドポイントを作成できる
* 指定した範囲のキャパシティないで自動で調整できる
* プロキシフリーとに接続してリソースのフリーとが自動的にスケーリングする

# Amazon Kinesis Data Analytics
* SQL処理でデータを分割する機能がある
* 直接S3など他のサービスに配信できる

# VPC
* DNSの利用
  * enable DnsHostnames VPC内のインスタンスはDNSホスト名を取得する
  * enableDnsSupport ONにしないと名前解決できない

# APIGateway
* スロットリング制限設定によりリクエスト件数を制御できる
* キャッシュをきかせることもできる

# ELB
* ヘルスチェック
* クロスゾーン負荷分散
* 暗号化通信
* スティッキーセッション
  * セッション確立したインスタンスと通信し続ける
* ConnectionDraining
  * 異常が発生した時そのインスタンスへのリクエストをやめる
* ログ取得
* Connection Drainingで異常なインスタンスへのELBリクエスト送信を止められる
* Auto Scaling設定でEC2ステータスかELBのヘルスチェックかを選択可能

# CloudFormation
* インフラ構成の展開
* Dependenciesという項目はない
* スタックセットを利用すると複数のAWSアカウントやリージョンにリソースを展開できる

# Step Functions
* サーバレスなワークフローのオーケストレーションサービス
* 人力によるアクションを必要とするタスクも作れる

# STS
* 限定的で一時的な認証情報を提供するサービス
* WebIDフェでレー損により外部IDプロバイダと連携できる

# AD
* Simple AD
  * フルマネージドAD
* AD Connector
  * オンプレのADとIAMを統合
* AWS Managed Microsoft AD
  * MS互換のAD
* AWS Directory Service
  * AWSリソースにアクセスできるユーザを制御する
# Storage Gateway
* デフォルトでS3を使用する

# VPN
* オンプレ側にはカスタマーゲートウェイを置く

# セキュリティ
* AWS WAF
  * ウェブエクスプロイト緩和、SQLインジェクションなどの攻撃パターンをブロック
* AWS Shield Advanced
  * CloudWatchによるリアルタイム通知DDoSの可視化
* AWS Shield Standard
  * レイヤー3,4の攻撃を軽減するがリアルタイム通知機能はない
* AWS OrganizationsでわりあてるのはSCP,IAMぽりしーではない
* AWS OrganizationsのSCPを有効化した時、デフォルトでメンバアカウントが属するOUに対してFullAWSAccessが付与される

# EFS
* オンプレからの移行の際にはオンプレにAWS DataSyncエージェントをインストールする
  * Datasyncは簡素化、自動化、高速化されている
* 利用するEC2インスタンスは同じVPCが望ましい

# コスト

* EC2の起動中はコストが発生
* 停止中のEBSにコストが発生

# Amazon FSx for Windows
* ADと連携させるのが必須

# Amazon OpenSearch Service
* いわゆる全文検索