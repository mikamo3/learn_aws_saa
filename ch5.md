# 5-1 仮想ネットワーク

## VPC

Virtual Private Cloud

AWS上にプライベートネットワークを構築する

つかわないときほんES2はすべてDMZに配置

サブネットはアベイラビリティゾーンをまたいで作成できないので1つのVPCないでアベイラビリティゾーンごとにサブネットを作る

社内ネットワークと接続する可能性があるときはIPが重複しないように

/28プレフィックス長以上を推奨

ELB/ALB/NLBを配置するときはサブネットに余裕をもたせる

IPを確保できないとスケールアウトできないため

## ルートテーブル

= linuxのroute

## パブリックサブネットとプライベートサブネット

パブリックサブネットにはVPCにインターネットへ出るためのGWがあタッチされる

プライベートにはそれがない

プライベートでインターネットにアクセスしたい場合はNATGatewayなどつかう

## NATゲートウェイ

プライベートサブネットを構築してインターネットへなにか通信したい場合などにつかう

アベイラビリティゾーンごとに1津配置する必要がある

インターネット側からNATゲートウェイにあくせすはできない

インターネット側からプライベートサブネットにアクセスしたい場合は踏み台構成にする

## VPCエンドポイント

AWSの一部のサービスでプライベート通信が可能

## Elastic IP

パブリックIPはインスタンス起動ごとにランダムで割り振られる

ElasticIPを利用おするには固定のグローバルIPを確保する

EC2インスタンスからインターネットに出る場合、いずれかのIPがヘッダに付与される

インスタンスごとにIPを付与すると手間になるためNATゲートウェイに割り振って集約することもできる


# 5-2 ネットワーク・セキュリティ

セキュリティグループはファイアウォール

プロトコル、IP、ポートを設定する

許可の設定のみ可能で拒否の設定はできない

重複した制限はゆるいほうが優先される

セキュリティグループ同士のアクセス制御が可能

例：DBにWebサーバのセキュリティグループIDを指定してWebサーバにはELBのセキュリティグループIDを指定してHTTPポートを開放したりできる

## ネットワークACL

サブネットに対してアクセス制御を行う

アクセス拒否設定が可能

ステートレスなのでリクエスト、レスポンス療法の設定が必要

## プライベート通信

## Direct Connect

オンプレとAWSのVPCを専用線で接続するサービス

VPNと比較して手間とコストがかかる

## VPN
Direct Connectに比べると安価だがインターネットを経由するため通信品質の安定性は低い

## VPCペアリング

VPC同士をセキュアに通信する

# 5-4 DNS

## Route53

DNSサービス。SLA100%

## Route53の機能

* シンプルルーティング
* 荷重ルーティング(複数のエンドポイントに対してトラフィックを分散できる)
* レイテンシルーティング(遅延が一番小さいリージョンにルーティング)
* フェイルオーバールーティング(障害時に別のエンドポイントへルーティングする.eg:sorrypage)
* 位置情報ルーティング(クライアントの位置情報をもとにエンドポイントを変える)


# CDN
## CDN

世界中に分散されたサーバ軍にコンテンツを配置して大規模なアクセスを処理して高速なコンテンツ配信を可能にしている

ユーザのアクセスを最も近いサーバにルーティングする。

サーバ側でコンテンツのキャッシングを行う

## AWSにおけるCDNの利用

CloudFrontがAWSのCDN

静的コンテンツはS3に、動的コンテンツはEC2などと振り分けられる