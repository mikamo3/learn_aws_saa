# ストレージ

## S3

ストレージサービス

### 特徴

* 容量実質無限
* 高耐久
* 安価
* 静的コンテンツ配信機能

### 主な要素

バケット：保存場所
オブジェクト：データ本体
キー：オブジェクト格納URL

## S3ストレージクラスとGlacierによるコスト最適化

### ストレージクラス

コストを最適化するためのオプション

### 低頻度アクセス

* S3標準IA:長期保存、バックアップ、災害対策用データストア
  * 取り出しにお金がかかる
* S3 1ゾーンIA:標準のアベイラビリティを必要としてないかつアクセス頻度は低
  * オンプレのセカンダリバックアップ、容易に作成し直せるデータの保存など

### Glacierによるアーカイブ

最も低いコスト

アクセスはほぼないが、コンプライアンス上保存が必要なものなど

データの取り出し時間に応じて料金が変わる

## 7-3 S3のセキュリティ

規制機関のコンプライアンスを満たしている

### バケットポリシー

アクセス権限を設定する機能

jsonベース

どのバケット、オブジェクトに対して
どのAPIを
誰から
許可、拒否するのか

### 暗号化

* クライアントサイド暗号化(ユーザ)
  * AWS側で複合できない
  * 鍵管理が面倒
* サーバサイド暗号化(AWS)
  * 透過的

### ロギング

いつ、誰が、何をしたかのログを残す

ログの改ざんされていないことを保証する

CloudTrailに記録する

Get/Putもすべて保存すると課金額が多くなるので用途に合わせて適切に記録する

### セキュアなファイルを配置する際のアクセス方法

アクセスのユースケース

* パブリック・アクセス可能にする
* アクセス権限が付与されたIAMユーザのアクセスキー、シークレットキーをEC2に配置してアクセス
* S3にアクセス権限が付与されたIAMロールをEC2に付与してアクセス

## 7-4 S3Webホスティング

Webサーバの設定不要

S3のスケーラビリティ、耐久性、可用性をそのまま利用できる

## 7-5 EBSのボリュームタイプ

EBS Elastic Block Store

EC2のストレージ

* EBSマグネティック:HDD
* 汎用SSD:ほとんどの環境で推奨
* プロビジョンドIOPS SSD(io1) 低レイテンシー、高スループット:MongoDBなど
* スループット最適化HDD 低コスト、データウェアハウス、ログ処理などのワークロード
* Cold HDD アクセス頻度の低いワークロード用の低コストHDD

## 7-6 EFS(Elastic File System)

### EFS

* NFSのような教養ストレージサーバ
* 使用した容量分だけの課金
* ペタバイトまで利用可能
* 保存容量に応じてスループット、IOPS性能が向上
* 複数のアベイラビリティゾーンに複製、保存されて高耐久、高可用性

### ユースケース

* bigdata分析、メディア処理ワークフロー
* コンテンツ管理とweb配信
* ホームディレクトリ





