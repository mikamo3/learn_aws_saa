# 高可用性構成

## 10-1 ロードバランサー

ELB Elastic Load Balancer が提供されている

以下の3種類ある

* CLB (Classic Load Balancer)
* ALB (Application Load Balancer)
* NLB (Network Load Balancer)

### ELB

* フルマネージド
* ヘルスチェック
* 高可用性
* スケーラブル
* 他サイト連動

構成例

ELBをVPC内で利用

ELB配下にEC2とRDSをアベイラビリティゾーンを分散して配置

基本はAZをわけるのがよいがレイテンシがシビアなどの条件がある場合は1つのアベイラビリティゾーンによせる

DNSはELBが発行するドメイン名を指定する

スケールイン、アウトで動的にIPが変わるため

### Internet Facing/Internal

ELBはInternalでも利用可能

### SSL Termination

ELB側でHTTPSを受信して内部ではHTTPで通信する

負荷軽減になる

OpenSSLの脆弱性対応をAWSに投げられる

### スティッキーセッション

セッション維持している時同じEC2に送信する

オートスケールなどでEC2が変動したときはセッションが切れる

### CLB

レガシー

HTTP/HTTPS/TCP/SSL対応

### ALB

レイヤー７対応

* コンテントベースルーティング
  * URLパスでルーティングする
* 動的ポートマッピング
* WebSockets HTTP/2対応

### NLB

TCPの負荷分散に特化

CLB,ALBは突発的なアクセス増加に対応するためにAWSに暖気申請の必要があるがNLBは不要

CLB,ALBは通常のスケールイン、アウトに対応できない場合がある

高スループット,低レイテンシー

SSL Termination機能はない

ターゲットにEC2インスタンではなくIPを指定、オンプレにも対応

固定グローバルIP付与可能

SourceIP/Portがターゲットまで保持する

対応プロトコルはTCPのみ

